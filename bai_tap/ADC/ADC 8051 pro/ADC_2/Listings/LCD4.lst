C51 COMPILER V9.60.7.0   LCD4                                                              09/23/2024 21:04:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD4
OBJECT MODULE PLACED IN .\Objects\LCD4.obj
COMPILER INVOKED BY: C:\hoc\8051\Keil_C_v5\C51\BIN\C51.EXE ..\..\..\Library\LCD16x2_4bit\LCD4.c OPTIMIZE(8,SPEED) BROWSE
                    - DEBUG OBJECTEXTEND PRINT(.\Listings\LCD4.lst) TABS(2) OBJECT(.\Objects\LCD4.obj)

line level    source

   1          /*------------------------------------------------------------------*-
   2              Lcd4.c
   3            ---------------------------------------
   4              - Written by Nguyen Thanh Dang
   5              - Created date:   16/05/2012
   6              - Last Modified:  16/05/2012
   7          
   8              - Require:  
   9                * Declare hardware connections (in Port.h). Ex:
  10                  sbit LCD_RS = P0^0;
  11                  sbit LCD_RW = P0^1; (optional)
  12                  sbit LCD_EN = P0^2;
  13                  sbit LCD_D4 = P2^4;
  14                  sbit LCD_D5 = P2^5;
  15                  sbit LCD_D6 = P2^6;
  16                  sbit LCD_D7 = P2^7;
  17                * Define USE_LCD_RW and USE_CHECK_BUSY (in Main.h) if you need. Ex:
  18                  #define USE_LCD_RW
  19                  #define USE_CHECK_BUSY  
  20                * Use LX51 (Option for Target - Device tab - 
  21                  Use Extended Linker (LX51)...)
  22                * Use REMOVEUNUSED linker directive (Option for Target - 
  23                  LX51 Misc tab - Misc controls: RU)
  24                  
  25              adc_value = Read_AD_Data(0x94);     //AIN0 doc gia tri tu triet ap AD1 tren bo kit8051 pro
  26              adc_value = Read_AD_Data(0xD4);   //   AIN1 doc gia tri tu dien tro nhiet NTC1
  27              adc_value = Read_AD_Data(0xA4);   //   AIN2 doc gia tri tu quang dien tro
  28              adc_value = Read_AD_Data(0xE4);   //   AIN3 doc gia tri tu bo DAC 
  29          -*------------------------------------------------------------------*/
  30          #include "Main.h"
  31          #include "Port.h"
  32          #include "C:\hoc\8051\bai_tap\Library\LCD16x2_4bit\LCD4.h"
  33          #include "C:\hoc\8051\bai_tap\Library\Delay\Delay.h"
  34          #include "String.h"
  35          
  36          #ifdef  USE_CHECK_BUSY
                #message "Lcd - Use check busy method."
                #ifndef USE_LCD_RW
                  #error "Lcd - Define USE_LCD_RW, please."
                #endif
              #else
  42            #message "Lcd - Use delay method."
*** MESSAGE C320 IN LINE 42 OF ..\..\..\Library\LCD16x2_4bit\LCD4.c: "Lcd - Use delay method."
  43          #endif
  44          
  45          /*-------------------------------------*-
  46            Prototype of Local Functions  
  47          -*-------------------------------------*/
  48          void Lcd_Write_High_Nibble(unsigned char);
  49          void Lcd_Write_Low_Nibble(unsigned char );
  50          void Lcd_Delay_us(unsigned char);
  51          #ifdef  USE_CHECK_BUSY
              void Lcd_Busy();
              #endif
C51 COMPILER V9.60.7.0   LCD4                                                              09/23/2024 21:04:16 PAGE 2   

  54          
  55          
  56          /*-------------------------------------*-
  57            Lcd_Write_High_Nibble - Local Function
  58          -*-------------------------------------*/
  59          void Lcd_Write_High_Nibble(unsigned char b)
  60          {
  61   1        LCD_D7 = b & 0x80;
  62   1        LCD_D6 = b & 0x40;
  63   1        LCD_D5 = b & 0x20;
  64   1        LCD_D4 = b & 0x10;  
  65   1      }
  66          
  67          /*-------------------------------------*-
  68            Lcd_Write_High_Low - Local Function
  69          -*-------------------------------------*/
  70          void Lcd_Write_Low_Nibble(unsigned char b)
  71          {
  72   1        LCD_D7 = b & 0x08;
  73   1        LCD_D6 = b & 0x04;
  74   1        LCD_D5 = b & 0x02;
  75   1        LCD_D4 = b & 0x01;
  76   1      }
  77          
  78          /*-------------------------------------*-
  79            Lcd_Delay_us - Local Function
  80          -*-------------------------------------*/
  81          void Lcd_Delay_us(unsigned char t)
  82          {
  83   1        while(t--);
  84   1      }
  85          
  86          /*-------------------------------------*-
  87            Lcd_Busy - Local Function
  88          -*-------------------------------------*/
  89          #ifdef  USE_CHECK_BUSY
              void Lcd_Busy()
              {
                bit busy_flag;
                LCD_D7 = 1;     // Read data
                LCD_RS = 0;
                LCD_RW = 1;     // Read
                do{
                  LCD_EN = 0;   // Read High Nibble
                  LCD_EN = 1;
                  busy_flag = LCD_D7;
                  LCD_EN = 0;   // Read Low Nibble
                  LCD_EN = 1;
                }while(busy_flag);
                LCD_EN = 0; 
              }
              #endif
 106          
 107          /*-------------------------------------*-
 108            Lcd_Init
 109            - Khoi tao LCD che do 4 bit, font 5x7
 110          -*-------------------------------------*/
 111          void Lcd_Init()
 112          { 
 113   1        LCD_RS = 0;
 114   1        LCD_EN = 0;
 115   1      #ifdef  USE_LCD_RW
C51 COMPILER V9.60.7.0   LCD4                                                              09/23/2024 21:04:16 PAGE 3   

                LCD_RW = 0;
              #endif
 118   1        
 119   1        Delay_ms(20);
 120   1      
 121   1        Lcd_Write_Low_Nibble(0x03);
 122   1        LCD_EN = 1;
 123   1        LCD_EN = 0;
 124   1          Delay_ms(5);
 125   1      
 126   1        Lcd_Write_Low_Nibble(0x03);
 127   1        LCD_EN = 1;
 128   1        LCD_EN = 0;
 129   1          Lcd_Delay_us(100);
 130   1      
 131   1        Lcd_Write_Low_Nibble(0x03);
 132   1        LCD_EN = 1;
 133   1        LCD_EN = 0;
 134   1      #ifdef  USE_CHECK_BUSY
                Lcd_Busy(); 
              #else
 137   1        Delay_ms(1);
 138   1      #endif
 139   1      
 140   1        Lcd_Write_Low_Nibble(0x02);
 141   1        LCD_EN = 1;
 142   1        LCD_EN = 0;
 143   1        Delay_ms(1);
 144   1          
 145   1        Lcd_Cmd(_LCD_4BIT_2LINE_5x7FONT);
 146   1        Lcd_Cmd(_LCD_TURN_ON);
 147   1        Lcd_Cmd(_LCD_CLEAR);
 148   1        Lcd_Cmd(_LCD_ENTRY_MODE);
 149   1      }
 150          
 151          /*-------------------------------------*-
 152            Lcd_Cmd
 153            - Gui lenh cho LCD
 154          -*-------------------------------------*/
 155          void Lcd_Cmd(unsigned char cmd)
 156          {
 157   1      #ifdef  USE_LCD_RW
                LCD_RW = 0;
              #endif
 160   1        LCD_RS = 0;
 161   1        Lcd_Write_High_Nibble(cmd); 
 162   1        LCD_EN = 1;
 163   1        LCD_EN = 0;
 164   1      
 165   1        Lcd_Write_Low_Nibble(cmd);
 166   1        LCD_EN = 1;
 167   1        LCD_EN = 0;
 168   1      
 169   1      #ifdef  USE_CHECK_BUSY
                Lcd_Busy(); 
              #else
 172   1        switch(cmd)
 173   1        {
 174   2          case _LCD_CLEAR:
 175   2          case _LCD_RETURN_HOME:
 176   2            Delay_ms(2);
 177   2            break;
C51 COMPILER V9.60.7.0   LCD4                                                              09/23/2024 21:04:16 PAGE 4   

 178   2          default:
 179   2            Lcd_Delay_us(37);
 180   2            break;
 181   2        }
 182   1      #endif
 183   1      }
 184          
 185          /*-------------------------------------*-
 186            Lcd_Chr_Cp
 187          -*-------------------------------------*/
 188          void Lcd_Chr_Cp(unsigned char achar)
 189          {
 190   1      #ifdef  USE_LCD_RW
                LCD_RW = 0;
              #endif
 193   1        LCD_RS = 1;
 194   1        Lcd_Write_High_Nibble(achar);
 195   1        LCD_EN = 1;
 196   1        LCD_EN = 0;
 197   1        
 198   1        Lcd_Write_Low_Nibble(achar);
 199   1        LCD_EN = 1;
 200   1        LCD_EN = 0;
 201   1        
 202   1      #ifdef  USE_CHECK_BUSY
                Lcd_Busy(); 
              #else
 205   1        Lcd_Delay_us(37+4);
 206   1      #endif  
 207   1      } 
 208          
 209          /*-------------------------------------*-
 210            Lcd_Chr
 211            - In ky tu ra man hinh tai (row, column)
 212          -*-------------------------------------*/
 213          void Lcd_Chr(unsigned char row, unsigned char column, unsigned char out_char)
 214          {
 215   1        unsigned char add;
 216   1        add = (row==1?0x80:0xC0);
 217   1        add += (column - 1);
 218   1        Lcd_Cmd(add);
 219   1        Lcd_Chr_Cp(out_char);
 220   1      }
 221          
 222          void Lcd_Out_Cp(unsigned char *str)
 223          {
 224   1        unsigned char i = 0;
 225   1        while(str[i])
 226   1        {
 227   2          Lcd_Chr_Cp(str[i]);
 228   2          i++;
 229   2        }
 230   1      }
 231          
 232          /*-------------------------------------*-
 233            Lcd_Out
 234            - In chuoi (text) ra man hinh
 235            - Vi tri bat dau tai (row, column)
 236          -*-------------------------------------*/
 237          void Lcd_Out(unsigned char row, unsigned char column, unsigned char *text)
 238          {
 239   1        unsigned char add;
C51 COMPILER V9.60.7.0   LCD4                                                              09/23/2024 21:04:16 PAGE 5   

 240   1        add = (row==1?0x80:0xC0);
 241   1        add += (column - 1);
 242   1        Lcd_Cmd(add);
 243   1        Lcd_Out_Cp(text); 
 244   1      }
 245          
 246          /*-------------------------------------*-
 247            Lcd_Custom_Chr Function
 248            - Tao ky tu tren LCD
 249            - Tham so:
 250              location: Vi tri tren CGRAM (0÷7)
 251              lcd_char: Con tro den mang Font ky tu
 252            - Ex: Tao ky tu "Clock" sau do in len dong 1, cot 1
 253              unsigned char code Lcd_Char_Clock[] = {14,21,21,23,17,17,14,0};
 254              //...
 255              Lcd_Init();
 256              Lcd_Custom_Chr(0,Lcd_Char_Clock);
 257              Lcd_Chr(1,1,0);
 258              //...
 259          -*-------------------------------------*/
 260          void Lcd_Custom_Chr(unsigned char location, unsigned char *lcd_char) 
 261          {
 262   1          unsigned char i;
 263   1          Lcd_Cmd(0x40+location*8);
 264   1          for (i = 0; i<=7; i++) 
 265   1          Lcd_Chr_Cp(lcd_char[i]);
 266   1      }
 267          
 268          /*------------------------------------------------------------------*-
 269            --- Ket thuc file ---------------------
 270          -*------------------------------------------------------------------*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    317    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
