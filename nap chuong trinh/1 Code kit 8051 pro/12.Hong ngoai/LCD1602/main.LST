C51 COMPILER V9.60.7.0   MAIN                                                              09/16/2024 12:01:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\hoc\8051\Keil_C_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg51.h>
   2          #include"lcd.h"
   3          
   4          sbit IRIN=P3^2;
   5          
   6          unsigned char code CDIS1[13]={" Red Control "};
   7          unsigned char code CDIS2[13]={" IR-CODE:--H "};
   8          
   9          unsigned char IrValue[6];
  10          unsigned char Time;
  11          
  12          void IrInit();
  13          void DelayMs(unsigned int );
  14          
  15          void main()
  16          {
  17   1        unsigned char i;
  18   1        IrInit(); 
  19   1        LcdInit();
  20   1        LcdWriteCom(0x80);
  21   1        for(i=0;i<13;i++)
  22   1        {
  23   2          LcdWriteData(CDIS1[i]); 
  24   2        }
  25   1        LcdWriteCom(0x80+0x40);
  26   1        for(i=0;i<13;i++)
  27   1        {
  28   2          LcdWriteData(CDIS2[i]); 
  29   2        }
  30   1        while(1)
  31   1        {
  32   2          IrValue[4]=IrValue[2]>>4;    
  33   2          IrValue[5]=IrValue[2]&0x0f; 
  34   2          if(IrValue[4]>9)
  35   2          {
  36   3            LcdWriteCom(0xc0+0x09);   
  37   3            LcdWriteData(0x37+IrValue[4]);
  38   3          }
  39   2          else
  40   2          {
  41   3            LcdWriteCom(0xc0+0x09);
  42   3            LcdWriteData(IrValue[4]+0x30);  
  43   3          } 
  44   2          if(IrValue[5]>9)
  45   2          {
  46   3            LcdWriteCom(0xc0+0x0a);
  47   3            LcdWriteData(IrValue[5]+0x37);  
  48   3          }
  49   2          else
  50   2          {
  51   3            LcdWriteCom(0xc0+0x0a);
  52   3            LcdWriteData(IrValue[5]+0x30);  
  53   3          } 
  54   2        }
  55   1      }                  
C51 COMPILER V9.60.7.0   MAIN                                                              09/16/2024 12:01:18 PAGE 2   

  56          
  57          void DelayMs(unsigned int x)   
  58          {
  59   1       unsigned char i;
  60   1       while(x--)
  61   1       {
  62   2        for (i = 0; i<13; i++);
  63   2       }
  64   1      }
  65          
  66          void IrInit()
  67          {
  68   1        IT0=1;  //Bit dieu khien cho phep INT0 tac dong bang muc hay bang canh(0: muc; 1: canh)
  69   1        EX0=1;  // cho phep ngat INT0
  70   1        EA=1;   //cho phep ngat toan cuc
  71   1      
  72   1        IRIN=1; //chân ngat INT0 P3^2 set len muc 1 (khong can set cung duoc vi luc khong nhan du lieu thi luon o
             - muc 1 roi)
  73   1      }
  74          
  75          void ReadIr() interrupt 0
  76          {
  77   1        unsigned char j,k;
  78   1        unsigned int err;
  79   1        
  80   1        Time=0;          
  81   1        DelayMs(70);
  82   1      
  83   1        if(IRIN==0)   // khi nhan du lieu
  84   1        {  
  85   2          err=1000;   // check loi    
  86   2          while((IRIN==0)&&(err>0)) //neu nhan du lieu dong thoi dem check loi
  87   2          {     
  88   3            DelayMs(1);
  89   3            err--;
  90   3          } 
  91   2          if(IRIN==1)     
  92   2          {
  93   3            err=500;
  94   3            while((IRIN==1)&&(err>0))    
  95   3            {
  96   4              DelayMs(1);
  97   4              err--;
  98   4            }
  99   3            for(k=0;k<4;k++)    
 100   3            {       
 101   4              for(j=0;j<8;j++)  
 102   4              {
 103   5                err=60;   
 104   5                while((IRIN==0)&&(err>0))
 105   5      //          while (!IRIN)
 106   5                {
 107   6                  DelayMs(1);
 108   6                  err--;
 109   6                }
 110   5                err=500;
 111   5                while((IRIN==1)&&(err>0))  
 112   5                {
 113   6                  DelayMs(1);//0.14ms
 114   6                  Time++;
 115   6                  err--;
 116   6                  if(Time>30)
C51 COMPILER V9.60.7.0   MAIN                                                              09/16/2024 12:01:18 PAGE 3   

 117   6                  {
 118   7                    EX0=1;
 119   7                    return;
 120   7                  }
 121   6                }
 122   5                IrValue[k]>>=1;  
 123   5                if(Time>=8)     
 124   5                {
 125   6                  IrValue[k]|=0x80;
 126   6                }
 127   5                Time=0;             
 128   5              }
 129   4            }
 130   3          }
 131   2          if(IrValue[2]!=~IrValue[3])
 132   2          {
 133   3            return;
 134   3          }
 135   2        }     
 136   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    421    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
