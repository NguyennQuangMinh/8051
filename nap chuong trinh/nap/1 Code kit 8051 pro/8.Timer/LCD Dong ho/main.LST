C51 COMPILER V9.01   MAIN                                                                  08/29/2013 13:50:12 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*******************************************************************************
   2          * 实验名         : 定时器实验
   3          * 使用的IO       : 
   4          * 实验效果       :1602显示时钟，按K3进入时钟设置，按K1选择设置的时分秒，按K2选择
   5          *选择设置加1。 
   6          * 注意           ：
   7          *******************************************************************************/
   8          #include<reg51.h> 
   9          #include"lcd.h"
  10          sbit K1=P3^0;
  11          sbit K2=P3^1;
  12          sbit K3=P3^2;
  13          sbit K4=P3^3;
  14          
  15          unsigned char Time;
  16          //用来计时间的值
  17          
  18          void Delay1ms(unsigned int c);
  19          void TimerConfiguration();
  20          void Int0Configuration();
  21          
  22          unsigned char SetPlace;
  23           
  24          /*******************************************************************************
  25          * 函 数 名         : main
  26          * 函数功能       : 主函数
  27          * 输    入         : 无
  28          * 输    出         : 无
  29          *******************************************************************************/
  30          void main(void)
  31          {
  32   1        unsigned char hour,minit,second;
  33   1        unsigned int i;
  34   1        TimerConfiguration();
  35   1        Int0Configuration();
  36   1        LcdInit();
  37   1        hour=12;
  38   1        LcdWriteData('0'+hour/10);
  39   1        LcdWriteData('0'+hour%10);
  40   1        LcdWriteData('-');
  41   1        LcdWriteData('0'+minit/10);
  42   1        LcdWriteData('0'+minit%10);
  43   1        LcdWriteData('-');
  44   1        LcdWriteData('0'+second/10);
  45   1        LcdWriteData('0'+second%10);
  46   1        while(1)
  47   1        {
  48   2          if(TR0==0)
  49   2          {
  50   3            if(K1==0)   //检测按键K2是否按下
  51   3            {
  52   4              Delay1ms(10); //消除抖动
  53   4              if(K1==0)
  54   4              {
  55   5                SetPlace++;
C51 COMPILER V9.01   MAIN                                                                  08/29/2013 13:50:12 PAGE 2   

  56   5                if(SetPlace>=3)
  57   5                  SetPlace=0;         
  58   5              }
  59   4      
  60   4              while((i<50)&&(K1==0))   //检测按键是否松开
  61   4              {
  62   5                Delay1ms(1);
  63   5                i++;
  64   5              }
  65   4              i=0;
  66   4            }
  67   3            if(K2==0)   //检测按键K3是否按下
  68   3            {
  69   4              Delay1ms(10); //消除抖动
  70   4              if(K2==0)
  71   4              {
  72   5                if(SetPlace==0)
  73   5                {
  74   6                  second++;
  75   6                  if(second>=60)
  76   6                    second=0;
  77   6                }
  78   5                else if(SetPlace==1)
  79   5                {
  80   6                  minit++;
  81   6                  if(minit>=60)
  82   6                    minit=0;  
  83   6                }
  84   5                else
  85   5                {
  86   6                  hour++;
  87   6                  if(hour>=24)
  88   6                    hour=0;
  89   6                }       
  90   5              }
  91   4      
  92   4              while((i<50)&&(K2==0))   //检测按键是否松开
  93   4              {
  94   5                Delay1ms(1);
  95   5                i++;
  96   5              }
  97   4              i=0;
  98   4            }
  99   3          } 
 100   2          if(Time>=20)   //一秒钟来到改变数值
 101   2          {
 102   3            Time=0;
 103   3            second++;
 104   3            if(second==60)
 105   3            {
 106   4              second=0;
 107   4              minit++;
 108   4              if(minit==60)
 109   4              {
 110   5                minit=0;
 111   5                hour++;
 112   5                if(hour==24)
 113   5                {
 114   6                  hour=0; 
 115   6                }
 116   5              }       
 117   4            }         
C51 COMPILER V9.01   MAIN                                                                  08/29/2013 13:50:12 PAGE 3   

 118   3          } 
 119   2            //--显示时钟--//
 120   2          LcdWriteCom(0x80);
 121   2          LcdWriteData('0'+hour/10);
 122   2          LcdWriteData('0'+hour%10);
 123   2          LcdWriteCom(0x83);
 124   2          LcdWriteData('0'+minit/10);
 125   2          LcdWriteData('0'+minit%10);
 126   2          LcdWriteCom(0x86);
 127   2          LcdWriteData('0'+second/10);
 128   2          LcdWriteData('0'+second%10);
 129   2        
 130   2        }       
 131   1      }
 132          /*******************************************************************************
 133          * 函 数 名       : Delay1ms()
 134          * 函数功能     : 延时1ms
 135          * 输    入       : c
 136          * 输    出       : 无
 137          *******************************************************************************/       
 138          
 139          void Delay1ms(unsigned int c)   //误差 0us
 140          {
 141   1          unsigned char a,b;
 142   1        for (; c>0; c--)
 143   1        {
 144   2          for(b=199;b>0;b--)
 145   2          {
 146   3            for(a=1;a>0;a--);
 147   3          }
 148   2              
 149   2        }
 150   1          
 151   1      }
 152          
 153          /*******************************************************************************
 154          * 函 数 名         : TimerConfiguration()
 155          * 函数功能       : 配置定时器值
 156          * 输    入         : 无
 157          * 输    出         : 无
 158          *******************************************************************************/       
 159          
 160          void TimerConfiguration()
 161          {
 162   1          TMOD = 0x01; //选择工作方式1
 163   1          TH0 = 0x3C;  //设置初始值
 164   1          TL0 = 0x0B0; 
 165   1          EA = 1;      //打开总中断
 166   1          ET0 = 1;     //打开定时器0中断
 167   1          TR0 = 1;     //启动定时器0
 168   1      }
 169          /*******************************************************************************
 170          * 函 数 名         : Timer0()
 171          * 函数功能       : 定时器0中断函数
 172          * 输    入         : 无
 173          * 输    出         : 无
 174          *******************************************************************************/       
 175          
 176          void Timer0() interrupt 1
 177          {
 178   1          TH0 = 0x3C;  //设置初始值
 179   1          TL0 = 0x0B0;
C51 COMPILER V9.01   MAIN                                                                  08/29/2013 13:50:12 PAGE 4   

 180   1          Time++;
 181   1      }
 182          /*******************************************************************************
 183          * 函 数 名         : Int0Configuration()
 184          * 函数功能       : 配置外部中断0
 185          * 输    入         : 无
 186          * 输    出         : 无
 187          *******************************************************************************/       
 188          
 189          void Int0Configuration()
 190          {
 191   1        //设置INT0
 192   1        IT0=1;//跳变沿出发方式（下降沿）
 193   1        EX0=1;//打开INT0的中断允许。
 194   1        EA=1;//打开总中断 
 195   1      }
 196          /*******************************************************************************
 197          * 函 数 名         : Int0() interrupt 0
 198          * 函数功能       : 外部中断0的中断函数
 199          * 输    入         : 无
 200          * 输    出         : 无
 201          *******************************************************************************/       
 202          
 203          void Int0() interrupt 0    
 204          {
 205   1        Delay1ms(10);
 206   1        if(K3==0)
 207   1        {
 208   2          TR0=~TR0;
 209   2          SetPlace=0;
 210   2        }
 211   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    493    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
