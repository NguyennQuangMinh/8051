C51 COMPILER V9.60.7.0   MAIN                                                              08/28/2024 17:16:57 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\hoc\8051\Keil_C_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          
   2          #include<reg51.h>
   3          //#include<intrins.h> 
   4          
   5          #define GPIO_DIG P0
   6          #define GPIO_KEY P1
   7          
   8          sbit LSA=P2^2;
   9          sbit LSB=P2^3;
  10          sbit LSC=P2^4;
  11          
  12          unsigned char code DIG_CODE[17]={
  13          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  14          0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  15          
  16          unsigned char KeyValue;
  17          
  18          unsigned char KeyState; 
  19          unsigned char DisplayData[8];
  20          
  21          unsigned char Num;
  22          void Delay50us();
  23          void KeyDown();    
  24          void DigDisplay();
  25          void TimerConfiguration();
  26          
  27          void main(void)
  28          {
  29   1        TimerConfiguration();
  30   1        KeyState=0;  
  31   1        while(1)
  32   1        {
  33   2          KeyDown();
  34   2          if(KeyState==1)
  35   2          {
  36   3            DisplayData[7]=DisplayData[6];
  37   3            DisplayData[6]=DisplayData[5];
  38   3            DisplayData[5]=DisplayData[4];
  39   3            DisplayData[4]=DisplayData[3];
  40   3            DisplayData[3]=DisplayData[2];
  41   3            DisplayData[2]=DisplayData[1];
  42   3            DisplayData[1]=DisplayData[0];
  43   3            DisplayData[0]=DIG_CODE[KeyValue];
  44   3            KeyState=0;
  45   3          }
  46   2      //    DigDisplay();
  47   2        }       
  48   1      }
  49          
  50          void TimerConfiguration()
  51          {
  52   1        TMOD=0X02;
  53   1      
  54   1        TH0=0X9C; 
  55   1        TL0=0X9C; 
C51 COMPILER V9.60.7.0   MAIN                                                              08/28/2024 17:16:57 PAGE 2   

  56   1        ET0=1;
  57   1        EA=1;
  58   1        TR0=1;  
  59   1      }
  60          
  61          void DigDisplay()
  62          {
  63   1        unsigned char i,j;
  64   1      //  for(i=0;i<8;i++)
  65   1      //  {
  66   1          GPIO_DIG=0x00;//消隐
  67   1          switch(i)  //位选，选择点亮的数码管，
  68   1          {
  69   2            case(0):
  70   2              LSA=0;LSB=0;LSC=0; break;
  71   2            case(1):
  72   2              LSA=1;LSB=0;LSC=0; break;
  73   2            case(2):
  74   2              LSA=0;LSB=1;LSC=0; break;
  75   2            case(3):
  76   2              LSA=1;LSB=1;LSC=0; break;
  77   2            case(4):
  78   2              LSA=0;LSB=0;LSC=1; break;
  79   2            case(5):
  80   2              LSA=1;LSB=0;LSC=1; break;
  81   2            case(6):
  82   2              LSA=0;LSB=1;LSC=1; break;
  83   2            case(7):
  84   2              LSA=1;LSB=1;LSC=1; break; 
  85   2          }
  86   1          GPIO_DIG=DisplayData[i];
  87   1          i++;
  88   1          if(i>7)
  89   1            i=0;
  90   1      //    j=10;            //扫描间隔时间设定
  91   1      //    while(j--)
  92   1      //      Delay50us();  
  93   1      //    GPIO_DIG=0x00;//消隐
  94   1      //  }
  95   1      }
*** WARNING C280 IN LINE 63 OF main.c: 'j': unreferenced local variable
  96          
  97          void KeyDown(void)
  98          {
  99   1        unsigned int a=0;
 100   1        GPIO_KEY=0x0f;
 101   1        if(GPIO_KEY!=0x0f)
 102   1        {
 103   2          Delay50us();
 104   2          a++;  
 105   2          a=0;
 106   2          if(GPIO_KEY!=0x0f)
 107   2          {
 108   3            ET0=0;
 109   3            KeyState=1;
 110   3            
 111   3            GPIO_KEY=0X0F;
 112   3      //      Delay50us();
 113   3            switch(GPIO_KEY)
 114   3            {
 115   4              case(0X07): KeyValue=0;break;
 116   4              case(0X0b): KeyValue=1;break;
C51 COMPILER V9.60.7.0   MAIN                                                              08/28/2024 17:16:57 PAGE 3   

 117   4              case(0X0d): KeyValue=2;break;
 118   4              case(0X0e): KeyValue=3;break;
 119   4      //        default:  KeyValue=17;  
 120   4            }
 121   3            
 122   3            GPIO_KEY=0XF0;
 123   3            Delay50us();
 124   3            switch(GPIO_KEY)
 125   3            {
 126   4              case(0X70): KeyValue=KeyValue;break;
 127   4              case(0Xb0): KeyValue=KeyValue+4;break;
 128   4              case(0Xd0): KeyValue=KeyValue+8;break;
 129   4              case(0Xe0): KeyValue=KeyValue+12;break;
 130   4      //        default:  KeyValue=17;
 131   4            }
 132   3            ET0=1;
 133   3            while((a<5000)&&(GPIO_KEY!=0xf0)) 
 134   3            {
 135   4              Delay50us();
 136   4              a++;
 137   4            }
 138   3            a=0;
 139   3          }
 140   2        }
 141   1      }
 142          
 143          void Delay50us(void)   
 144          {
 145   1          unsigned char a,b;
 146   1          for(b=1;b>0;b--)
 147   1              for(a=22;a>0;a--);
 148   1      }
 149          
 150          void Timer() interrupt 1
 151          {
 152   1        DigDisplay(); 
 153   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    368    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
