C51 COMPILER V9.01   MAIN                                                                  08/16/2013 16:37:41 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*******************************************************************************
   2          * 实 验 名     : 步进电机实验
   3          * 使用的IO       : 电机用P1口,键盘使用P3.0、P3.1、P3.2、P3.3
   4          * 实验效果       : 按下K1键，顺时针转，按下K2键，逆时针转，按下K3键，低速，
   5          *按下K4键，高速。
   6          * 注    意     ：由于P3.2口跟红外线共用，所以做按键实验时为了不让红外线影响实验
   7          *效果，最好把红外线先取下来。
   8          *******************************************************************************/ 
   9          #include "reg52.h"
  10          
  11          //电机IO
  12          #define GPIO_MOTOR P1
  13          //sbit F1 = P1^0;
  14          //sbit F2 = P1^1;
  15          //sbit F3 = P1^2;
  16          //sbit F4 = P1^3;
  17          //按键IO
  18          sbit K1=P3^0;
  19          sbit K2=P3^1;
  20          sbit K3=P3^2;
  21          sbit K4=P3^3;
  22          
  23          unsigned char code FFW[8]={0xf1,0xf3,0xf2,0xf6,0xf4,0xfc,0xf8,0xf9}; //反转顺序
  24          unsigned char code FFZ[8]={0xf9,0xf8,0xfc,0xf4,0xf6,0xf2,0xf3,0xf1}; //正转顺序
  25          
  26          unsigned char Direction,Speed;
  27          void Delay(unsigned int t);
  28          void  Motor(); 
  29          
  30          /*******************************************************************************
  31          * 函 数 名       : main
  32          * 函数功能     : 主函数
  33          * 输    入       : 无
  34          * 输    出       : 无
  35          *******************************************************************************/
  36          
  37          void main(void) 
  38          { 
  39   1        unsigned char i;
  40   1        Speed=30;
  41   1        while(1)
  42   1        {
  43   2          if(K1==0)   //检测按键K1是否按下
  44   2          {
  45   3            Delay(1); //消除抖动
  46   3            if(K1==0)
  47   3            {
  48   4              Direction=1;
  49   4            }
  50   3            while((i<200)&&(K1==0))  //检测按键是否松开
  51   3            {
  52   4              Delay(1);
  53   4              i++;
  54   4            }
  55   3            i=0;
C51 COMPILER V9.01   MAIN                                                                  08/16/2013 16:37:41 PAGE 2   

  56   3          }
  57   2          if(K2==0)   //检测按键K1是否按下
  58   2          {
  59   3            Delay(1); //消除抖动
  60   3            if(K2==0)
  61   3            {
  62   4              Direction=2;
  63   4            }
  64   3            while((i<200)&&(K2==0))  //检测按键是否松开
  65   3            {
  66   4              Delay(1);
  67   4              i++;
  68   4            }
  69   3            i=0;
  70   3          }     
  71   2          if(K3==0)   //检测按键K1是否按下
  72   2          {
  73   3            Delay(1); //消除抖动
  74   3            if(K3==0)
  75   3            {
  76   4              Speed=13;
  77   4            }
  78   3            while((i<200)&&(K3==0))  //检测按键是否松开
  79   3            {
  80   4              Delay(1);
  81   4              i++;
  82   4            }
  83   3            i=0;
  84   3          }
  85   2          if(K4==0)   //检测按键K1是否按下
  86   2          {
  87   3            Delay(1); //消除抖动
  88   3            if(K4==0)
  89   3            {
  90   4              Speed=40;
  91   4            }
  92   3            while((i<200)&&(K4==0))  //检测按键是否松开
  93   3            {
  94   4              Delay(1);
  95   4              i++;
  96   4            }
  97   3            i=0;
  98   3          }   
  99   2          Motor();
 100   2        }
 101   1      }
 102          /*******************************************************************************
 103          * 函 数 名         : Motor
 104          * 函数功能       : 电机旋转函数
 105          * 输    入         : 无
 106          * 输    出         : 无
 107          *******************************************************************************/
 108          
 109          void  Motor()
 110          { 
 111   1        unsigned char i;
 112   1        for(i=0;i<8;i++)
 113   1        {
 114   2          if(Direction==1) 
 115   2            GPIO_MOTOR = FFW[i]&0x1f;  //取数据
 116   2          if(Direction==2) 
 117   2            GPIO_MOTOR = FFZ[i]&0x1f;
C51 COMPILER V9.01   MAIN                                                                  08/16/2013 16:37:41 PAGE 3   

 118   2          Delay(Speed); //调节转速  
 119   2        }                   
 120   1      }
 121          /*******************************************************************************
 122          * 函 数 名         : Delay
 123          * 函数功能       : 延时
 124          * 输    入         : t
 125          * 输    出         : 无
 126          *******************************************************************************/
 127          void Delay(unsigned int t)
 128          {                           
 129   1        unsigned int k;
 130   1        while(t--)
 131   1        {
 132   2          for(k=0; k<80; k++)
 133   2          { }
 134   2        }
 135   1      }
 136          
 137          
 138          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    221    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
